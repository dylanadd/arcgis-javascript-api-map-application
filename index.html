<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=7, IE=9, IE=10">
    <!--The viewport meta tag is used to improve the presentation and behavior
    of the samples on iOS devices-->
    <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no">
    <title>Parcel Locator</title>
 <link rel="stylesheet" href="http://js.arcgis.com/3.7/js/dojo/dijit/themes/tundra/tundra.css">
    <link rel="stylesheet" href="http://js.arcgis.com/3.7/js/esri/css/esri.css">
    <style>
      html, body, #map {
        height: 100%;
        width: 100%;
        margin: 0;
        padding: 0;
      }
      
      path {z-index: 1000;}
      
      #button-console {
      	position: relative;
		z-index: 999;
		height: 0;
      
      }
      
       #feedback {
       /* background: #fff;*/
        color: #000;
        position: absolute;
        font-family: arial;
        height: auto;
        right: 20px;
        margin: 5px;
        padding: 10px;
        top: 20px;
        width: 300px;
        z-index: 40;
      }
      #feedback a {
        border-bottom: 1px solid #888;
        color: #444;
        text-decoration: none;
      }
      #feedback a:hover, #feedback a:active, #feedback a:visited {
        border: none;
        color: #444;
        text-decoration: none;
      }
      #note { font-size: 80%; font-weight: 700; padding: 0 0 10px 0; }
      
      
      
      
      
      /*Begin imported css from older doc */
      
        .search_wrapper{
      border: 2px solid #666;
background: #fff;
-webkit-border-radius: 5px;
border-radius: 5px;
left: 100px;
position: absolute;
z-index: 30;
top: 46px;
      }
      
      .searchbox {
      outline: 0;
display: block;
border: 0;
border-collapse: collapse;
vertical-align: middle;
font-size: 12px;
line-height: 16px;
margin: 0;
padding: 6px 0;
float: left;
color: #444;
background: none;
margin: 0 6px;
width: 168px;
}
      div.search_button  span.dijitButtonNode {
     background: url("simpleGeocoder.png") no-repeat 0 0;
     
     float: left;
outline: 0;
width: 16px;
height: 16px;
display: block;
overflow: hidden;
margin-top: 3px;
margin-left:3px;
border: none !important;

      }
      
      div.search_button {
      float: left;
      }
      
      div#map_zoom_slider div.esriSimpleSliderIncrementButton {
position: absolute;
z-index: 30;
top: 39px;
background-color: white; 
-webkit-border-radius: 5px 0px 0px 5px;
border-radius: 5px 0px 0px 5px;
border: 2px solid #666;

      }
      
      div#map_zoom_slider div.esriSimpleSliderDecrementButton {
position: absolute;
z-index: 30;
top: 39px;
left: 33px;
background-color: white;
-webkit-border-radius: 0px 5px 5px 0px;
border-radius: 0px 5px 5px 0px;
border: 2px solid #666;
}
     /*
       div#map_zoom_slider {
       top: -20px;
       }
    */ 
      .esriSimpleSlider {
      border: none !important;
      }
      
      
      .esriPopup {
      z-index: 100;
      }
      
    
    #gallery {
    position: absolute;
    z-index: 999;
    top: 1px;
    right: 1px;
	display: inline-block;
    
    }
     #print_button {
     	position: relative;
		float: right;
		margin-top: -11px;
     }
      
      
      .logo-med {
    visibility: hidden;
height: 0;
width: 0;
margin: 0;
padding: 0;  
      }
      
      
      .esriScalebarLabel {
       color: white;
  
      } 
      
      .map .container {
      position: initial !important;
      }
      
      
    </style>
<!--<script src="//ajax.googleapis.com/ajax/libs/dojo/1.9.1/dojo/dojo.js"></script>-->


    <script>var dojoConfig = { parseOnLoad: true };</script>
    <script src="http://js.arcgis.com/3.7/"></script>
    <script>
      
    var map;
    var parcels;
    var infoArray;
    var draw = null;
    var gsvc, tb;
    require([
        "esri/map", "esri/layers/FeatureLayer",
        "esri/layers/ArcGISTiledMapServiceLayer", "esri/tasks/query",
        "esri/symbols/SimpleFillSymbol", "esri/symbols/SimpleLineSymbol",
        "esri/graphic", "esri/dijit/Popup", "esri/dijit/PopupTemplate",
        "esri/urlUtils", "esri/graphicsUtils",
        "dojo/_base/Color",
        "dojo/on", "dojo/query", "dojo/parser", "dojo/dom-construct", "dojo/keys", "dijit/registry", "dojo/dom",
        "esri/dijit/Print", "esri/tasks/PrintTemplate", "esri/request", "esri/config", "dojo/_base/array",
        "esri/dijit/BasemapGallery", "esri/arcgis/utils", "esri/dijit/BasemapLayer", "esri/dijit/Basemap",
        "esri/dijit/Scalebar", "esri/dijit/Measurement", "esri/tasks/locator", "esri/symbols/SimpleMarkerSymbol",
        "esri/symbols/Font", "esri/symbols/TextSymbol", "dojo/number", "esri/geometry/webMercatorUtils", "esri/InfoTemplate",
        "dojo/dom-attr", "esri/sniff", "esri/SnappingManager", "esri/renderers/SimpleRenderer",
        "esri/tasks/GeometryService", "esri/tasks/BufferParameters", "esri/toolbars/draw",


        "dijit/layout/BorderContainer", "dijit/layout/ContentPane", "dojo/domReady!", "dijit/form/Button"], function (
    Map, FeatureLayer,
    ArcGISTiledMapServiceLayer, Query,
    SimpleFillSymbol, SimpleLineSymbol,
    Graphic, Popup, PopupTemplate,
    urlUtils, graphicsUtils,
    Color,
    on, query, parser, domConstruct, keys, registry, dom,
    Print, PrintTemplate, esriRequest, esriConfig, arrayUtils,
    BasemapGallery, arcgisUtils, BasemapLayer, Basemap, Scalebar, Measurement,
    Locator, SimpleMarkerSymbol, Font, TextSymbol, number, webMercatorUtils, InfoTemplate,
    domAttr, has, SnappingManager, SimpleRenderer, GeometryService, BufferParameters, Draw

    ) {

        parser.parse();

        //apply a selection symbol that determines the symbology for selected features 
        var sfs = new SimpleFillSymbol(
        SimpleFillSymbol.STYLE_SOLID,
        new SimpleLineSymbol(
        SimpleLineSymbol.STYLE_SOLID,
        new Color([111, 0, 255]),
        2),
        new Color([111, 0, 255, 0.15]));

		var gsvc, tb;

        var popup = new Popup({
            fillSymbol: sfs
        }, domConstruct.create("div"));

        //Create basemaps
        var countyLayer = new BasemapLayer({
            url: "http://maps.co.pueblo.co.us/ArcGIS/rest/services/Pueblo_photos/MapServer"
        });

        var countyBasemap = new Basemap({
            layers: [countyLayer],
            title: "County Basemap (Fast)"
            //  thumbnailUrl:"images/waterThumb.png"
        });

        var zoningLayer = new BasemapLayer({
            url: "http://maps.co.pueblo.co.us/ArcGIS/rest/services/zoning/MapServer"
        });

        var zoningBasemap = new Basemap({
            layers: [zoningLayer],
            title: "Zoning Basemap (Fast)"
            //  thumbnailUrl:"images/waterThumb.png"
        });

        var imagery2005Layer = new BasemapLayer({
            url: "http://maps.co.pueblo.co.us/ArcGIS/rest/services/2005_1meter_imagery/MapServer"
        });

        var imagery2005Basemap = new Basemap({
            layers: [imagery2005Layer],
            title: "2005 Imagery (Slow)"
            //  thumbnailUrl:"images/waterThumb.png"
        });


        var imagery2004Layer = new BasemapLayer({
            url: "http://maps.co.pueblo.co.us/ArcGIS/rest/services/2004_1ft_Imagery/MapServer"
        });

        var imagery2004Basemap = new Basemap({
            layers: [imagery2004Layer],
            title: "2004 Imagery (Slow)"
            //  thumbnailUrl:"images/waterThumb.png"
        });

        var imagery2001Layer = new BasemapLayer({
            url: "http://maps.co.pueblo.co.us/ArcGIS/rest/services/2001_6in_imagery/MapServer"
        });

        var imagery2001Basemap = new Basemap({
            layers: [imagery2001Layer],
            title: "2001 Imagery (Slow)"
            //  thumbnailUrl:"images/waterThumb.png"
        });

        var imagery1991Layer = new BasemapLayer({
            url: "http://maps.co.pueblo.co.us/ArcGIS/rest/services/1991_Imagery/MapServer"
        });

        var imagery1991Basemap = new Basemap({
            layers: [imagery1991Layer],
            title: "1991 Imagery (Slow)"
            //  thumbnailUrl:"images/waterThumb.png"
        });

        var floodplainsLayer = new BasemapLayer({
            url: "http://maps.co.pueblo.co.us/ArcGIS/rest/services/floodplains/MapServer"
        });

        var floodplainsBasemap = new Basemap({
            layers: [floodplainsLayer],
            title: "Floodplains (Slow)"
            //  thumbnailUrl:"images/waterThumb.png"
        });

        var taxSaleLayer = new BasemapLayer({
            url: "http://maps.co.pueblo.co.us/ArcGIS/rest/services/tax_sale/MapServer"
        });

        var taxSaleBasemap = new Basemap({
            layers: [taxSaleLayer],
            title: "Tax Sale (Fast)"
            //  thumbnailUrl:"images/waterThumb.png"
        });


        var harnLayer = new BasemapLayer({
            url: ""
        });

        var harnBasemap = new Basemap({
            layers: [harnLayer],
            title: "No Basemap"
            //  thumbnailUrl:"images/waterThumb.png"
        });

        //Map constructor
        map = new Map("map", {
            //basemap: "County Basemap",
            infoWindow: popup,
            slider: true,
            sliderOrientation: "horizontal",
            //  sliderPosition: "bottom-right",
            zoom: 1

        });

        
        
        
		//Buffer Function
	 map.on("load", initToolbar);

      gsvc = new GeometryService("http://tasks.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer");
  //add proxy functions for all modules
      esriConfig.defaults.io.proxyUrl = "proxy.php";
      esriConfig.defaults.io.alwaysUseProxy = false;

      function initToolbar(evtObj) {
          app.tb = new Draw(evtObj.map);
          app.tb.on("draw-end", doBuffer);
        }

        function doBuffer(evtObj) {
          var geometry = evtObj.geometry,
          map = app.map,
          gsvc = app.gsvc;
          switch (geometry.type) {
             case "point":
               var symbol = new SimpleMarkerSymbol(SimpleMarkerSymbol.STYLE_SQUARE, 10, new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, new Color([255,0,0]), 1), new Color([0,255,0,0.25]));
               break;
             case "polyline":
               var symbol = new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new Color([255,0,0]), 1);
               break;
             case "polygon":
               var symbol = new SimpleFillSymbol(SimpleFillSymbol.STYLE_NONE, new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASHDOT, new Color([255,0,0]), 2), new Color([255,255,0,0.25]));
               break;
          }

          var graphic = new Graphic(geometry, symbol);
          map.graphics.add(graphic);

          //setup the buffer parameters
          var params = new BufferParameters();
          params.distances = [ dom.byId("distance").value ];
          params.bufferSpatialReference = new esri.SpatialReference({wkid: dom.byId("bufferSpatialReference").value});
          params.outSpatialReference = map.spatialReference;
          params.unit = GeometryService[dom.byId("unit").value];

          if (geometry.type === "polygon") {
            //if geometry is a polygon then simplify polygon.  This will make the user drawn polygon topologically correct.
            gsvc.simplify([geometry], function(geometries) {
              params.geometries = geometries;
              gsvc.buffer(params, showBuffer);
            });
          } else {
            params.geometries = [geometry];
            gsvc.buffer(params, showBuffer);
          }
        }

        function showBuffer(bufferedGeometries) { 
          var symbol = new SimpleFillSymbol(
            SimpleFillSymbol.STYLE_SOLID,
            new SimpleLineSymbol(
              SimpleLineSymbol.STYLE_SOLID,
              new Color([255,0,0,0.65]), 2
            ),
            new Color([255,0,0,0.35])
          );

          arrayUtils.forEach(bufferedGeometries, function(geometry) {
            var graphic = new Graphic(geometry, symbol);
            app.map.graphics.add(graphic);
          });
          app.tb.deactivate();
          app.map.showZoomSlider();
        }

        app = {
          map: map,
          tb: tb,
          gsvc: gsvc
        };


        var basemap = new ArcGISTiledMapServiceLayer("http://maps.co.pueblo.co.us/ArcGIS/rest/services/Pueblo_photos/MapServer");
        //  var basemap = new ArcGISTiledMapServiceLayer("http://maps.co.pueblo.co.us/ArcGIS/rest/services/tax_sale/MapServer");
        var parcelInfoLayer = new ArcGISTiledMapServiceLayer("http://maps.co.pueblo.co.us/ArcGIS/rest/services/pueblocounty/MapServer");
        map.addLayer(basemap);
        map.addLayer(parcelInfoLayer);


        //BEGIN functions for print dijit
        var printUrl = "http://sampleserver6.arcgisonline.com/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task";

       

        // get print templates from the export web map task
        var printInfo = esriRequest({
            "url": printUrl,
                "content": {
                "f": "json"
            }
        });
        printInfo.then(handlePrintInfo, handleError);

        function handlePrintInfo(resp) {
            var layoutTemplate, templateNames, mapOnlyIndex, templates;

            layoutTemplate = arrayUtils.filter(resp.parameters, function (param, idx) {
                return param.name === "Layout_Template";
            });

            if (layoutTemplate.length == 0) {
                console.log("print service parameters name for templates must be \"Layout_Template\"");
                return;
            }
            templateNames = layoutTemplate[0].choiceList;

            // remove the MAP_ONLY template then add it to the end of the list of templates 
            mapOnlyIndex = arrayUtils.indexOf(templateNames, "MAP_ONLY");
            if (mapOnlyIndex > -1) {
                var mapOnly = templateNames.splice(mapOnlyIndex, mapOnlyIndex + 1)[0];
                templateNames.push(mapOnly);
            }

            // create a print template for each choice
            templates = arrayUtils.map(templateNames, function (ch) {
                var plate = new PrintTemplate();
                plate.layout = plate.label = ch;
                plate.format = "PDF";
                plate.layoutOptions = {
                    "authorText": "Made by:  Esri's JS API Team",
                        "copyrightText": "<copyright info here>",
                        "legendLayers": [],
                        "titleText": "Pueblo County GIS",
                        "scalebarUnit": "Miles"
                };
                return plate;
            });

            // create the print dijit
            var printer = new Print({
                "map": map,
                    "templates": templates,
                url: printUrl
            }, dom.byId("print_button"));
            printer.startup();
        }

        function handleError(err) {
            console.log("Something broke: ", err);
        }
        //END print dijit functions


        //BEGIN Basemap Toggle
        var basemapGallery = new BasemapGallery({
            showArcGISBasemaps: false,
            map: map
        }, "basemapGallery");

        basemapGallery.startup();

        basemapGallery.add(countyBasemap);
        basemapGallery.add(zoningBasemap);
        basemapGallery.add(imagery2005Basemap);
        basemapGallery.add(imagery2004Basemap);
        basemapGallery.add(imagery2001Basemap);
        basemapGallery.add(imagery1991Basemap);
        basemapGallery.add(floodplainsBasemap);
        // basemapGallery.add(taxSaleBasemap);
        basemapGallery.add(harnBasemap);


        basemapGallery.on("error", function (msg) {
            console.log("basemap gallery error:  ", msg);
        });
       

        basemapGallery.on("selection-change", function () {
            //	alert("test");
            //basemapGallery.startup();
            map.removeLayer(parcelInfoLayer);
            map.addLayer(parcelInfoLayer);
            
       //    console.dir(basemapGallery.getSelected());
        });




        //End Basemap Toggle


        //BEGIN Legend Dijit
        /*
             map.on("layers-add-result", function (evt) {
         var layerInfo = arrayUtils.map(evt.layers, function (layer, index) {
           return {layer:layer.layer, title:layer.layer.name};
         });
         if (layerInfo.length > 0) {
           var legendDijit = new Legend({
             map: map,
             layerInfos: layerInfo
           }, "legendDiv");
           legendDijit.startup();
         }
       });
         */
        //END Legend Dijit



        //BEGIN scalebar Dijit

        var scalebar = new Scalebar({
            map: map,
            // "dual" displays both miles and kilmometers
            // "english" is the default, which displays miles
            // use "metric" for kilometers
            scalebarUnit: "english"
        });

        //END scalebar Dijit




        //BEGIN measurement Dijit

        esriConfig.defaults.geometryService = new GeometryService("http://tasks.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer");




        var measurement = new esri.dijit.Measurement({
            map: map
        }, dojo.byId('measurementDiv'));
        measurement.startup();
        domAttr.set("measurementDiv", "style", "visibility: hidden"); //hide the widget initially






        //END measurement Dijit


        //apply a popup template to the parcels layer to format popup info 
        var popupTemplate = new PopupTemplate({
            title: "Parcel Number: {PAR_NUM}",
            fieldInfos: [{
                fieldName: "Owner",
                label: "Owner:",
                visible: true
            }, {
                fieldName: "OwnerOverflow",
                label: "Owner Overflow:",
                visible: true
            }, {
                fieldName: "OwnerStreetAddress",
                label: "Owner Address:",
                visible: true
            }, {
                fieldName: "OwnerCity",
                label: "Owner City:",
                visible: true
            }, {
                fieldName: "OwnerState",
                label: "Owner State:",
                visible: true
            }, {
                fieldName: "OwnerZip",
                label: "Owner Zip Code:",
                visible: true
            }]
        });

        //add the parcels layer to the map as a feature layer in selection mode we'll use this layer to query and display the selected parcels
        parcels = new FeatureLayer("http://maps.co.pueblo.co.us/ArcGIS/rest/services/pueblocounty/MapServer/13", {
            outFields: ["*"],
            infoTemplate: popupTemplate,
            mode: FeatureLayer.MODE_SELECTION
        });

        parcels.setSelectionSymbol(sfs);

        //when users click on the map select the parcel using the map point and update the url parameter
        map.on("click", function (e) {
            if (draw == false || draw == null) {
                var query = new Query();
                query.geometry = e.mapPoint;
                //FeatureLayer.SELECTION_ADD for multiple or FeatureLayer.SELECTION_NEW for single parcel
                var deferred = parcels.selectFeatures(query, FeatureLayer.SELECTION_ADD, function (selection) {
                    //update the url param if a parcel was located
                    if (selection.length > 0) {
                        var parcelid = selection[0].attributes["PAR_NUM"];
                        infoArray = selection[0];
                        //Refresh the URL with the currently selected parcel
                        if (typeof history.pushState !== "undefined") {
                            //  window.history.pushState(null, null, "?parcelid=" + selection[0].attributes.PAR_NUM);
                            infoArray = selection[0];
                        }
                    }
                });
                map.infoWindow.setFeatures([deferred]);
                map.infoWindow.show(e.mapPoint);

                infoArray = selection[0];

            }
        });




        //LISTEN FOR BUTTON CLICKS
        on(dom.byId("clear"), "click", clearx);
        on(dom.byId("draw"), "click", drawMode);
        on(dom.byId("empty"), "click", empty);
        on(dom.byId("locate"), "click", locate);
        // 	on(dom.byId("lock"), "click", lockMap);


        map.on("layers-add-result", function (result) {
            // Add a link into the InfoWindow Actions panel       
            var emailLink = domConstruct.create("a", {
                "class": "action",
                    "innerHTML": "Add Parcel Info",
                    "href": "javascript:void(0);"
            }, query(".actionList", map.infoWindow.domNode)[0]);

            // Register a function to be called when the user clicks on
            // the above link
            on(emailLink, "click", function (evt) {
                info();
                /* var feature = map.infoWindow.getSelectedFeature();
             var url = window.location;
             var emailLink = "mailto:?subject=Parcel Map of :" + 
               feature.attributes.PAR_NUM + "&body=Check out this map: %0D%0A " + 
               window.location;
             window.location.href = emailLink; */
            });



            //When users navigate through the history using the browser back/forward buttons select appropriate parcel  
            //https://developer.mozilla.org/en/DOM/Manipulating_the_browser_history
            window.onpopstate = function (event) {
                var parcelid = getParcelFromUrl(document.location.href);
                if (parcelid) {
                    selectParcel(parcelid);


                } else {
                    parcels.clearSelection();
                    map.infoWindow.hide();
                }
            };

            //if a parcelid is specified in url param select that feature 
            var parcelid = getParcelFromUrl(document.location.href);
            selectParcel(parcelid);
        });

        map.addLayers([parcels]);

        //extract the parcel id from the url
        function getParcelFromUrl(url) {
            var urlObject = urlUtils.urlToObject(url);
            if (urlObject.query && urlObject.query.parcelid) {
                return urlObject.query.parcelid;
            } else {
                return null;
            }
        }



        //BEGIN Location Dijit

        var locator = new Locator("http://maps.co.pueblo.co.us/ArcGIS/rest/services/PCGIS_Geocoding_Service/GeocodeServer");
        // var  locator = new Locator("http://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer");
        locator.on("address-to-locations-complete", showResults);



        function locate() {
            map.graphics.clear();
            var address = {
                //  "SingleLine": dom.byId("address").value
                "Street": dom.byId("address").value
            };
            locator.outSpatialReference = map.spatialReference;
            var options = {
                address: address,
                outFields: ["Loc_name"]
            }
            locator.addressToLocations(options);
        }

        function showResults(evt) {
            var candidate;
            var symbol = new SimpleMarkerSymbol();
            var infoTemplate = new InfoTemplate(
                "Location",
                "Address: ${address}<br />Score: ${score}<br />Source locator: ${locatorName}");
            symbol.setStyle(SimpleMarkerSymbol.STYLE_CIRCLE);
            symbol.setColor(new Color([35, 186, 199, 0.75]));

            var geom;
            arrayUtils.every(evt.addresses, function (candidate) {
                console.log(candidate.score);
                if (candidate.score > 80) {
                    console.log(candidate.location);
                    var attributes = {
                        address: candidate.address,
                        score: candidate.score,
                        locatorName: candidate.attributes.Loc_name
                    };
                    geom = candidate.location;
                    var graphic = new Graphic(geom, symbol, attributes, infoTemplate);
                    //add a graphic to the map at the geocoded location
                    map.graphics.add(graphic);
                    //add a text symbol to the map listing the location of the matched address.
                    var displayText = candidate.address;
                    var font = new Font(
                        "16pt",
                    Font.STYLE_NORMAL,
                    Font.VARIANT_NORMAL,
                    Font.WEIGHT_BOLD,
                        "Helvetica");

                    var textSymbol = new TextSymbol(
                    displayText,
                    font,
                    new Color("#FF0033"));
                    textSymbol.setOffset(0, 8);
                    map.graphics.add(new Graphic(geom, textSymbol));
                    return false; //break out of loop after one candidate with score greater  than 80 is found.
                }
            });
            if (geom !== undefined) {
                map.centerAndZoom(geom, 12);
            }
        }
        //END Location Dijit







        function clearx() {
            parcels.clearSelection();
            map.infoWindow.hide();
            map.graphics.clear();
            window.history.pushState(null, null, "?parcelid=");
        }

        function info() {

            var s = "<table><tr>" +
                "<td>" + infoArray.attributes.PAR_NUM + "</td>" +
                "<td><a href=\"http://www.co.pueblo.co.us/cgi-bin/webatrbroker.wsc/propertyinfo.p?par=" + infoArray.attributes.PAR_TXT + "\" target=\"_blank\" >" + infoArray.attributes.PAR_TXT + "</a></td>" +
                "<td>" + infoArray.attributes.Fips + "</td>" +
                "<td>" + infoArray.attributes.Owner + "</td>" +
                "<td>" + infoArray.attributes.OwnerOverflow + "</td>" +
                "<td>" + infoArray.attributes.OwnerStreetAddress + "</td>" +
                "<td>" + infoArray.attributes.OwnerCity + "</td>" +
                "<td>" + infoArray.attributes.OwnerState + "</td>" +
                "<td>" + infoArray.attributes.OwnerZip + "</td>" +
                "</tr></table></div>";


            dom.byId("output").innerHTML += s;

        }

        function empty() {
            dom.byId("output").innerHTML = "";
        }

        function drawMode() {
            if (!draw) {
                draw = true;
                domAttr.set("draw", "value", "Turn Draw Off");
                domAttr.set("measurementDiv", "style", "visibility: visible");
                map.infoWindow.hide();
            } else if (draw) {
                draw = false;
                domAttr.set("draw", "value", "Turn Draw On");
                domAttr.set("measurementDiv", "style", "visibility: hidden");
            } else if (draw == null) {
                draw = true;
                domAttr.set("draw", "value", "Turn Draw Off");
                domAttr.set("measurementDiv", "style", "visibility: visible");
                map.infoWindow.hide();

            }


        }




        //select parcel from the feature layer by creating a query to look for the input parcel id 
        function selectParcel(parcelid) {
            if (parcelid) {
                var query = new Query();
                query.where = "PAR_NUM = '" + parcelid + "'";
                var deferred = parcels.selectFeatures(query, FeatureLayer.SELECTION_NEW, function (selection) {
                    var center = graphicsUtils.graphicsExtent(selection).getCenter();
                    var extHandler = map.on("extent-change", function () {
                        extHandler.remove();
                        //zoom to the center then display the popup 
                        map.infoWindow.setFeatures(selection);
                        map.infoWindow.show(center);
                        infoArray = selection[0];
                    });
                    map.centerAt(center);
                });
            }
        }
    });
    </script>
  </head>
  
  <body class="tundra">
    <div data-dojo-type="dijit/layout/BorderContainer" data-dojo-props="design:'headline',gutters:false" 
    style="width: 100%; height: 100%; margin: 0;">
     
     <div id="leftPane" style="z-index: 1000;"
         data-dojo-type="dijit.layout.ContentPane" 
         data-dojo-props="region:'right'">

      <div class="details">Pick a tool and draw on the map. The drawn graphic will be buffered based on the specified parameters.</div>
      <button data-dojo-type="dijit.form.Button" onclick="app.tb.activate(esri.toolbars.Draw.LINE);app.map.hideZoomSlider();">Line</button>
      <button data-dojo-type="dijit.form.Button" onclick="app.tb.activate(esri.toolbars.Draw.POLYLINE);app.map.hideZoomSlider();">Polyline</button>
      <button data-dojo-type="dijit.form.Button" onclick="app.tb.activate(esri.toolbars.Draw.FREEHAND_POLYLINE);app.map.hideZoomSlider();">Freehand Polyline</button>
      <br />
      <button data-dojo-type="dijit.form.Button" onclick="app.tb.activate(esri.toolbars.Draw.POLYGON);app.map.hideZoomSlider();">Polygon</button>
      <button data-dojo-type="dijit.form.Button" onclick="app.tb.activate(esri.toolbars.Draw.FREEHAND_POLYGON);app.map.hideZoomSlider();">Freehand Polygon</button>

      <br /><hr />
      <div><b>Buffer Parameters</b></div>
      Spatial Reference WKID: <input type="text" id="bufferSpatialReference" size="5" value="2233" /><br />
      Distance: <input type="text" id="distance" size="5" value="25" />
      <select id="unit" style="width:100px;">
        <option value="UNIT_STATUTE_MILE">Miles</option>
        <option value="UNIT_FOOT">Feet</option>
        <option value="UNIT_KILOMETER">Kilometers</option>
        <option value="UNIT_METER">Meters</option>
        <option value="UNIT_NAUTICAL_MILE">Nautical Miles</option>
        <option value="UNIT_US_NAUTICAL_MILE">US Nautical Miles</option>
        <option value="UNIT_DEGREE">Degrees</option>
      </select><br />
      <button data-dojo-type="dijit.form.Button" type="button" onclick="app.map.graphics.clear();">Clear Graphics</button>
    </div>
     
     
     
     <div id="button-console">
      
       <input id="clear" type="button" value="Clear"> 
      
       <input id="empty" type="button" value="Empty Table">
       <input id="draw" type="button" name="draw" value="Turn Draw On">
      <!--   <input id="lock" type="button" value="Lock Map"> -->
       <div id="output"></div>
       
       
      
       
       
       
       
          <div id="measurementDiv" style="visibility: hidden;"></div> 
       
       
       <div id="gallery" >
          <div data-dojo-type="dijit/TitlePane" 
               data-dojo-props="title:'Switch Basemap', closable:false,  open:false">
            <div data-dojo-type="dijit/layout/ContentPane" style="width:380px; height:280px; overflow:auto;">
            <div id="basemapGallery" ></div></div>
          </div>
        </div>
       
        <div id="feedback" class="shadow">
         <!--   <h3>
            Print Templates Created from Info Returned by the Print Service using 
            <a href="https://developers.arcgis.com/en/javascript/jsapi/namespace_esri.html#request">esri.request</a> 
          </h3> 
          <div id="info">
            <div id="note">
              Note:  This sample uses an ArcGIS Server version 10.1 export web map task.
            </div>
            -->
            <!-- that will be used for the print dijit -->
            <div id="print_button"></div>
<!-- 
            <div id="info">
              <a href="https://developers.arcgis.com/en/javascript/jsapi/printtemplate.html">Print templates</a> are generated 
              from the Export Web Map Task's <a href="http://sampleserver6.arcgisonline.com/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task">Layout_Template parameter</a>. This info is retrieved from the service 
              using <a href="https://developers.arcgis.com/en/javascript/jsapi/namespace_esri.html#request">esri.request</a>. 
            </div>
-->
          </div>
          
          
          
           <div class="search_wrapper">
	   <div class="search_button">
	   <input type="button" id="locate" />
	   </div>
	   <input type="text" id="address" class="searchbox" value="Pueblo, Co"/>
       

	   </div>
          
        </div>
     
     
     
      <div id="map" data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region:'center'">
      
      
       
       
       
       </div>
      </div>
   
  </body>

</html>